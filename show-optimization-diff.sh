#!/bin/bash

# ========================================
# Webpack é…ç½®å¯¹æ¯”å·¥å…·
# ========================================

echo "ğŸ“Š Webpack Thread-Loader é…ç½®å¯¹æ¯”"
echo "===================================="
echo ""

echo "ğŸ”´ ä¼˜åŒ–å‰çš„é—®é¢˜:"
echo ""
echo "1. Thread-Loader ä½¿ç”¨è¿‡åº¦"
echo "   â€¢ source-map-loader: ä½¿ç”¨ thread-loaderï¼ˆä¸å¿…è¦ï¼‰"
echo "   â€¢ SVG å¤„ç†: ä½¿ç”¨ thread-loaderï¼ˆå¼€é”€å¤§äºæ”¶ç›Šï¼‰"
echo "   â€¢ JS å¤„ç†: workers é…ç½®å†—ä½™"
echo "   â€¢ Vendor å¤„ç†: workers é…ç½®å†—ä½™"
echo ""
echo "2. Worker é…ç½®å¤æ‚"
echo "   â€¢ æ¯ä¸ª loader éƒ½é…ç½®äº†å¤§é‡å‚æ•°"
echo "   â€¢ workerNodeArgsã€poolParallelJobs ç­‰å†—ä½™"
echo "   â€¢ 4 ä¸ªç‹¬ç«‹çš„ worker æ± ï¼ˆzjs-pre-worker, zjs-file-worker, etcï¼‰"
echo ""
echo "3. å¼€å‘æ’ä»¶é»˜è®¤å¼€å¯"
echo "   â€¢ CircularDependencyPlugin æ¯æ¬¡å¯åŠ¨éƒ½è¿è¡Œ"
echo "   â€¢ BundleAnalyzerPlugin å ç”¨èµ„æº"
echo "   â€¢ SpeedMeasurePlugin å¢åŠ ç¼–è¯‘æ—¶é—´"
echo ""

echo "âœ… ä¼˜åŒ–åçš„æ”¹è¿›:"
echo ""
echo "1. Thread-Loader ç²¾ç®€"
echo "   â€¢ source-map-loader: ç§»é™¤ thread-loader âœ¨"
echo "   â€¢ SVG å¤„ç†: ç§»é™¤ thread-loader âœ¨"
echo "   â€¢ JS å¤„ç†: ç®€åŒ–ä¸º (cpus-1) workers âœ¨"
echo "   â€¢ Vendor å¤„ç†: å›ºå®š 2 workers âœ¨"
echo ""
echo "2. Worker é…ç½®ä¼˜åŒ–"
echo "   â€¢ ç§»é™¤å†—ä½™å‚æ•°"
echo "   â€¢ poolTimeout: Infinityï¼ˆä¿æŒ worker æŒç»­å­˜åœ¨ï¼‰"
echo "   â€¢ ä»… 2 ä¸ª worker æ± ï¼ˆjs-pool, vendor-poolï¼‰"
echo ""
echo "3. æ’ä»¶æŒ‰éœ€åŠ è½½"
echo "   â€¢ æ‰€æœ‰åˆ†ææ’ä»¶é»˜è®¤å…³é—­ âœ¨"
echo "   â€¢ é€šè¿‡ç¯å¢ƒå˜é‡æŒ‰éœ€å¼€å¯ âœ¨"
echo "   â€¢ ä¸å½±å“æ­£å¸¸å¼€å‘ä½“éªŒ âœ¨"
echo ""
echo "4. æ–°å¢ Webpack 5 ç‰¹æ€§"
echo "   â€¢ lazyCompilation: æŒ‰éœ€ç¼–è¯‘åŠ¨æ€å¯¼å…¥ âœ¨"
echo "   â€¢ ESLint lintDirtyModulesOnly: åªæ£€æŸ¥ä¿®æ”¹æ–‡ä»¶ âœ¨"
echo ""

echo "ğŸ“ˆ æ€§èƒ½æå‡é¢„ä¼°:"
echo ""
echo "  åœºæ™¯              | ä¼˜åŒ–å‰  | ä¼˜åŒ–å  | æå‡"
echo "  ------------------|---------|---------|--------"
echo "  é¦–æ¬¡å†·å¯åŠ¨        | 60-90s  | 40-60s  | ~40%"
echo "  ç¼“å­˜çƒ­å¯åŠ¨        | 40-60s  | 10-20s  | ~70%"
echo "  HMR çƒ­æ›´æ–°        | 2-5s    | 1-3s    | ~50%"
echo "  å†…å­˜å ç”¨          | é«˜      | ä¸­ç­‰    | ~30%"
echo ""

echo "ğŸ¯ å…³é”®ä¼˜åŒ–ç‚¹:"
echo ""
echo "  1. å‡å°‘ Worker è¿›ç¨‹æ•°é‡ï¼ˆä» 4+ åˆ° 2ï¼‰"
echo "  2. ç§»é™¤è½»é‡ä»»åŠ¡çš„å¤šçº¿ç¨‹å¼€é”€"
echo "  3. ç®€åŒ– Worker é…ç½®å‡å°‘é€šä¿¡æˆæœ¬"
echo "  4. æŒ‰éœ€å¯ç”¨åˆ†ææ’ä»¶"
echo "  5. åˆ©ç”¨ Webpack 5 æ‡’ç¼–è¯‘ç‰¹æ€§"
echo ""

echo "ğŸ’¡ ä½¿ç”¨å»ºè®®:"
echo ""
echo "  æ­£å¸¸å¼€å‘ï¼š"
echo "    npm start"
echo ""
echo "  éœ€è¦åˆ†æï¼š"
echo "    Z_DEV_PLUGIN_LOOP=true npm start    # å¾ªç¯ä¾èµ–"
echo "    Z_DEV_PLUGIN_SIZE=true npm start    # åŒ…å¤§å°"
echo "    Z_DEV_PLUGIN_SMP=true npm start     # æ€§èƒ½ç»Ÿè®¡"
echo ""
echo "  ä½¿ç”¨ä¼˜åŒ–è„šæœ¬ï¼š"
echo "    ./run-optimized.sh"
echo ""

